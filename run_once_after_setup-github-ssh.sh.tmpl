#!/bin/bash

# Ensure the public key exists (created by chezmoi from the encrypted private key)
ssh-keygen -y -f ~/.ssh/id_ed25519 > ~/.ssh/id_ed25519.pub

# Check if gh is installed and authenticated
if command -v gh >/dev/null 2>&1 && gh auth status >/dev/null 2>&1; then
    # Register the key if not already present on GitHub
    PUBKEY=$(cat ~/.ssh/id_ed25519.pub)
    if ! gh ssh-key list | grep -q "$PUBKEY"; then
        gh ssh-key add ~/.ssh/id_ed25519.pub --title "{{ .chezmoi.hostname }} (chezmoi)"
    fi
fi